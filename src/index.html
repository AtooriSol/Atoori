<html>

<head>
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <script src="js/js_atari.js" type="text/javascript"></script>
  <script src="js/prosystem/Bios.js" type="text/javascript"></script>
  <script src="js/prosystem/Pokey.js" type="text/javascript"></script>
  <script src="js/prosystem/Sound.js" type="text/javascript"></script>
  <script src="js/prosystem/Database.js" type="text/javascript"></script>
  <script src="js/prosystem/Timer.js" type="text/javascript"></script>
  <script src="js/prosystem/Rect.js" type="text/javascript"></script>
  <script src="js/prosystem/Region.js" type="text/javascript"></script>
  <script src="js/prosystem/Palette.js" type="text/javascript"></script>
  <script src="js/prosystem/Equates.js" type="text/javascript"></script>
  <script src="js/prosystem/Memory.js" type="text/javascript"></script>
  <script src="js/prosystem/Pair.js" type="text/javascript"></script>
  <script src="js/prosystem/Sally.js" type="text/javascript"></script>
  <script src="js/prosystem/Riot.js" type="text/javascript"></script>
  <script src="js/prosystem/Cartridge.js" type="text/javascript"></script>
  <script src="js/prosystem/Tia.js" type="text/javascript"></script>
  <script src="js/prosystem/Maria.js" type="text/javascript"></script>
  <script src="js/prosystem/ProSystem.js" type="text/javascript"></script>
  <script src="js/prosystem/ExpansionModule.js" type="text/javascript"></script>  
  <script src="js/3rdparty/jquery-min.js" type="text/javascript"></script>
  <script src="js/3rdparty/md5.js" type="text/javascript"></script>
</head>

<body>
  <div style="text-align: center">
    <canvas id="screen" width="320" height="300"></canvas>
  </div>
  <script>
    $(document).ready(function () {

      js_atari_init();

      function dropHandler(ev) {
        ev.preventDefault();
        var file = null;
        if (ev.dataTransfer.items) {
          for (var i = 0; i < ev.dataTransfer.items.length; i++) {
            if (ev.dataTransfer.items[i].kind === 'file') {
              file = ev.dataTransfer.items[i].getAsFile();
              break;
            }
          }
        } else {
          for (var i = 0; i < ev.dataTransfer.files.length; i++) {
            file = ev.dataTransfer.files[i];
            break;
          }
        }

        if (file) {
          if (file.size <= 1024 * 1024) /* 1024kb max */ {
            var reader = new FileReader();
            reader.readAsBinaryString(file);
            reader.onloadend = function () {
              var cart = new Array();
              for (var i = 0; i < reader.result.length; i++) {
                cart[i] = reader.result.charCodeAt(i);
              }
              js_atari_start_emulation(cart);
            }
          } else {
            //$("#status").text("File too large.");
            alert('File too large'); // TODO: What to do with this?
          }
        }
      }

      // Drag and drop
      $('body').on('drop dragdrop', function (evt) {
        evt.dataTransfer = evt.originalEvent.dataTransfer
        dropHandler(evt);
        event.preventDefault();
      });
      $('body').on('dragenter', function (event) {
        event.preventDefault();
        //$(this).css('border','10px dashed red');
      });
      $('body').on('dragleave', function () {
        //$(this).css('background','red');
      });
      $('body').on('dragover', function (event) {
        event.preventDefault();
      });

      document.onkeydown =
        function (event) {
          js_atari_key_event(event, true);
        };

      document.onkeyup =
        function (event) {
          js_atari_key_event(event, false);
        };
    });
  </script>
</body>

</html>